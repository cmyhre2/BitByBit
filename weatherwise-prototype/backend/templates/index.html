<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WeatherWise — Prototype</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#3aa7ff}
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:Inter,system-ui,Helvetica,Arial;
      color:#e6eef6;
      background:linear-gradient(180deg,#071226 0%, #0b1630 100%);
      -webkit-font-smoothing:antialiased;
    }
    .container{max-width:900px;margin:0 auto;padding:28px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:20px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{
      width:48px;height:48px;border-radius:10px;
      background:linear-gradient(135deg,var(--accent),#7ae0ff);
      display:flex;align-items:center;justify-content:center;
      color:#01233a;font-weight:700;font-size:18px
    }
    h1{margin:0;font-size:26px}
    .controls{display:flex;gap:8px;align-items:center}
    input[type="text"]{
      padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);
      background:rgba(255,255,255,0.02);color:inherit
    }
    button{
      padding:8px 12px;border-radius:8px;border:none;
      background:var(--accent);color:#01233a;font-weight:600
    }
    .card{
      background:var(--card);border-radius:12px;padding:18px;margin-top:18px;
      box-shadow:0 8px 30px rgba(4,9,20,0.6)
    }
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .stat{font-size:22px;font-weight:700}
    footer{
      color:var(--muted);font-size:13px;text-align:center;padding:20px 0;
      margin-top:30px;border-top:1px solid rgba(255,255,255,0.04)
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="brand">
        <div class="logo">WW</div>
        <div>
          <div style="font-weight:700;color:#eaf6ff">WeatherWise</div>
          <div style="font-size:12px;color:var(--muted)">Prototype</div>
        </div>
      </div>

      <div class="controls">
        <input id="q" type="text" placeholder="City, e.g. Louisville,US" />
        <button id="search">Search</button>
        <button id="geolocate">Use my location</button>
      </div>
    </header>

    <main>
      <div id="info" class="card">
        <div id="status" class="muted">Enter a city or use geolocation to get started.</div>
        <div id="forecast" style="margin-top:12px;display:none">
          <div style="display:flex;align-items:center;gap:18px">
            <div>
              <div id="city" style="font-size:20px;font-weight:700"></div>
              <div id="desc" class="muted" style="font-size:14px"></div>
            </div>
            <div style="margin-left:auto;text-align:right">
              <div id="temp" class="stat"></div>
              <div id="feels" class="muted" style="font-size:13px"></div>
            </div>
          </div>

          <div class="grid" style="margin-top:14px">
            <div class="card">
              <div class="muted">Humidity</div>
              <div id="humidity" style="font-weight:700"></div>
            </div>
            <div class="card">
              <div class="muted">Wind</div>
              <div id="wind" style="font-weight:700"></div>
            </div>
          </div>

          <div style="margin-top:12px" id="rawjson" class="muted"></div>
        </div>
      </div>
    </main>

    <footer>
      WeatherWise Prototype — demo only. Data via OpenWeatherMap (proxied through backend).
    </footer>
  </div>

<script>
async function getWeatherByQuery(q) {
  const res = await fetch('/api/weather?q=' + encodeURIComponent(q));
  return res.json();
}

async function getWeatherByCoords(lat, lon) {
  const res = await fetch(`/api/weather?lat=${lat}&lon=${lon}`);
  return res.json();
}

function showError(msg) {
  document.getElementById('status').textContent = msg;
  document.getElementById('forecast').style.display = 'none';
}

function showWeather(resp) {
  if (!resp || resp.error) {
    showError("Error: " + (resp.error ? JSON.stringify(resp.error) : "unknown"));
    return;
  }
  const data = resp.data;

  document.getElementById('status').style.display = 'none';
  document.getElementById('forecast').style.display = 'block';

  document.getElementById('city').textContent =
    (data.name || "Location") + (data.sys?.country ? ", " + data.sys.country : "");

  document.getElementById('desc').textContent = data.weather?.[0]?.description || "";
  document.getElementById('temp').textContent = Math.round(data.main?.temp) + "°C";
  document.getElementById('feels').textContent = "Feels like " + Math.round(data.main?.feels_like) + "°C";
  document.getElementById('humidity').textContent = data.main?.humidity + "%";
  document.getElementById('wind').textContent = data.wind?.speed + " m/s";

  document.getElementById('rawjson').textContent = JSON.stringify(data, null, 2);
}

document.getElementById('search').addEventListener('click', async () => {
  const q = document.getElementById('q').value.trim();
  if (!q) return showError("Please type a city.");
  document.getElementById('status').textContent = "Loading...";
  showError("Loading...");
  const r = await getWeatherByQuery(q);
  showWeather(r);
});

document.getElementById('geolocate').addEventListener('click', () => {
  if (!navigator.geolocation)
    return showError("Geolocation not supported.");
  document.getElementById('status').textContent = "Getting location...";
  navigator.geolocation.getCurrentPosition(async pos => {
    const r = await getWeatherByCoords(pos.coords.latitude, pos.coords.longitude);
    showWeather(r);
  }, err => {
    showError("Geolocation error: " + err.message);
  });
});
</script>
</body>
</html>
